{"componentChunkName":"component---src-templates-blog-post-js","path":"/SEEDlabs/bufferoverflow/","result":{"data":{"site":{"siteMetadata":{"title":"KunheeKim.Dev","author":"[Kunhee Kim]","siteUrl":"https://kunheekimkr.github.io","comment":{"disqusShortName":"","utterances":"kunheekimkr/kunheekimkr.github.io"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"64a6be85-e450-5368-9564-2396325c4c0f","excerpt":"Lab Instructions Task 2: Exploiting the Vulnerability The objective of this task is to write the program , to construct the content of  and launch a buffer overflow attack on the vulnerable program . To fill in , we need to investigate the stack frame layout of the  function in…","html":"<p><a href=\"https://seedsecuritylabs.org/Labs_16.04/PDF/Buffer_Overflow.pdf\">Lab Instructions</a></p>\n<h2 id=\"task-2-exploiting-the-vulnerability\" style=\"position:relative;\"><a href=\"#task-2-exploiting-the-vulnerability\" aria-label=\"task 2 exploiting the vulnerability permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Task 2: Exploiting the Vulnerability</h2>\n<p>The objective of this task is to write the program <code class=\"language-text\">exploit.c</code>, to construct the content of <code class=\"language-text\">badfile</code> and launch a buffer overflow attack on the vulnerable program <code class=\"language-text\">stack.c</code>.</p>\n<p>To fill in <code class=\"language-text\">exploit.c</code>, we need to investigate the stack frame layout of the <code class=\"language-text\">bof()</code> function in <code class=\"language-text\">stack.c</code>. This can be using gdb to debug <code class=\"language-text\">stack.c</code>. Use the following commands.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 735px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA5klEQVQY01WOWW6DQBBEuf8VTBbHBhkGMJhlBsRiwmb2RdynwkykSPl46pa6VfWk949P3G4avs5nyLIMRVVhmhauigpKKQjRoWk6KAsRhiGyLEMURUjTFEVRIElSdF2HsixRVRUkqigILxeYBoFOyPGQgDEmyPNv1HWN5/M3hFImAuM4/rvleY6+78XeNC9I9umEQH4DO2y4gee6IIaBIPBRNw3athUGwzBgHAcxp2nCsizYtg37vv9DopYF/zBzbBv3uy0MfN+H53l4OA4c5wH3KOHtPJjDjcZxxDzPmI/gdV0FvOAHmSAAt7AHIc8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-1\"\n        title=\"2-1\"\n        src=\"/static/02682b8c7ac6f9e63a2b67bbf371ffd9/7608e/1.png\"\n        srcset=\"/static/02682b8c7ac6f9e63a2b67bbf371ffd9/5a46d/1.png 300w,\n/static/02682b8c7ac6f9e63a2b67bbf371ffd9/0a47e/1.png 600w,\n/static/02682b8c7ac6f9e63a2b67bbf371ffd9/7608e/1.png 735w\"\n        sizes=\"(max-width: 735px) 100vw, 735px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 630px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACbElEQVQ4y02TaXLaUBCEdf8LONgYh4hVIJECLWgXCSAW4YTVGGy2i3RmJpbLP7peSTy+6Z4ZKZ1aHd1mE3arjdDzEUURDEOHqqromSbCMJJ3YRhgnKZYrVZYr9dybjYbbLdb7HY7vLy8iJTetwIiTUNK8rpdqNUaer2eKI4TDIdDjMdjJEmC0Wgs4meG5aD9fo/X11c5FccPUG3UUVIrKD09oa0bMM0efN/HdDpFv+8Q3MRgkKBKxYajEebZXGA5kGGHw0GkzOcZWs0G7u7u8FQqoe96sG2b3MU4Ho/wPA9+EGJLjtrtFkzLFOcMYeBXGN9XgiCCRsBC4V6Atu2QLMTJQC4kSQyXeruhvmnUa41a41LR4weEoRyV7769vUFJ0ylaWlOA5XL5w6GFIAzlUhSFsJ0+DWGJCg2q0+lIAhYPz6UEWZbhdDr9Bz4//4Wht/FQLKJSUSWe2+9TH02Jw8PgImuaKvdyMpnQYIakEVKa+vv7+6c7hiqLxR90jDYeKW61WoVDMNcloGVJJI5sWQ5FXqHRaKJLm2BZNrmaY0ZDC4KABhjIGp3PZyiz2VwiF4uPKH8v0x9owp5LDi0cqapPkcIoJrd7KmxI5Iie2Q0746LsjmECXGQL6C0ND/cPKJFLBjrUH47HcQaDATmyZO94oZfLJcEP8htDL5cLrqzrVaSEyS8YPzv4UatRDyvQdZ1c+bQiOsVYY7HIaJHTzx6xC4blwBx6+YAqflnFjBxN6dOLHQf1RkMGIl9IOpFIeTyGsr7CvgJZSkBOMmp8RM4cissgz3Xxm05ebp4qQ/Je5TB2msNut5u44/MfRm9Zhbkzi3cAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-2\"\n        title=\"2-2\"\n        src=\"/static/d9ff66f8bb45ee75842fa9246c0a442c/f058b/2.png\"\n        srcset=\"/static/d9ff66f8bb45ee75842fa9246c0a442c/5a46d/2.png 300w,\n/static/d9ff66f8bb45ee75842fa9246c0a442c/0a47e/2.png 600w,\n/static/d9ff66f8bb45ee75842fa9246c0a442c/f058b/2.png 630w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>The debug result shows that the address of the frame pointer is <code class=\"language-text\">0xbffea28</code>. Therefore, this is the Stack frame layout of <code class=\"language-text\">bof()</code> function.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 415px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACoElEQVQ4y31UyW4TQRDti5H4AMQdjlxIxE/waYgIBW5c4YCEEGtCiCJCIgESX0DASvA247E99iw9tmex51GvM205xqak5+6umiq/7lpUURQg8jxfC2ufzWbmHAQBxuMxwjCE1troKGVZmlUlSQJiOp0aTCaTxZ6gM+0MEMcxWq0WPM9Du91Gs9k031wJyJ/5fA7HceC6LkajEXq9Hvr9vjlbB/sH68QGWwSkgvQJMiITrjzzupQ0TRcBSYA+dr3CUMdylUjeJYkEMSZjLY6JWamjXesQQ79vnmMdq2UxDGfVYRDkqF/0cN700egEoMu8sqVCNAwjNBp/zFNsCqqSXw8Q/34CXd9FUn+E8OdDRGc7iH/tyHlXbI+Nfnj2VFjHxokZ3xgQn4TkscLko0L9mYL3SqH1QuH8uUL4XqH8LPYjhfTkBsKhg3bHlYT1NgfUewr68DqSwxpGezWE+zUEguGHGuKDmuivQR8oDI9uY6J9qbsZsnSpVFag+O96X8F9KU5vFfw3Cj1hOXit4Ihu9E4YCsvs9CbCoIuO62Hg+5cB1yUl/3oL42/34B/fFWwhPN3G6Ms2gpMtowtOtpF/v4Pox31MvRYKt4vMdSSDA5TSNVLhwMUFpMpZW1DM3jQDMnnnVLooTmaIkuKKjt9Ql0iAVFBIfUoNoZQAUrQAAxOSLHVJdF5lr0C366DTaUlGk6rgLm15liIU57Z0lCddtPHK7IYoikx3WFBn97Tx7Mu7TavCZjJsQsp/kvKfql+2revl9XVY9SaFU6XRaJhJ0rfXqpzYy2TLScNO4dhaMF2dNlY4CDimCA6HZcmyzOjIkvaN04YNzw8J7ulI2Flo9fYtGYx7shxI6ay2obIBLHg1YlXPK3LlvGRAPgn3qwH/Alc2kG9bKeK3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-3\"\n        title=\"2-3\"\n        src=\"/static/d2b1599738a427703b9286f08a3425cc/73926/3.png\"\n        srcset=\"/static/d2b1599738a427703b9286f08a3425cc/5a46d/3.png 300w,\n/static/d2b1599738a427703b9286f08a3425cc/73926/3.png 415w\"\n        sizes=\"(max-width: 415px) 100vw, 415px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>The return address is 24 + 8 + 4 =36 bytes above from Buffer, so write the following code to fill in <code class=\"language-text\">badfile</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 958px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEoUlEQVQ4y02UyXPbZBjGfeXIcOH/4MSJ7cIwHAjDAQ7pFneaNpkuoU0bCrRT6AFKS9NOO0MnQEu6ApOJ43iVJS+StVirZcuSN1le0oYO/8PDK2Uph2fesTzfT+/zvO+n2OxvIg4/9DCz6uLg/SYOP3AQp98HH/Vx4OErTe/q/8+OPB1i5tkIR54MSAEW1nzETi9dw9mTJ3FsPo65M/OIn4jj4NFDVGcizZCOko7PzWB2bvfZ8RkcmT2M04uncO7iWcyenEV8Lo4vlxYRm4rfwuenfsKZ++tYWM3i7KM0LjxO4fxqEhce7egr0pWnKXz3LI2LT9P4+lmGKunJTv32zyyurDG4/HgTsfnF6/h5+XcU82UUN/OQ1xJQGRaKrEKraZFqigaFpKomTKOOZr0Bu95Ew3bQbLTQbrkY+z0Y9F/so8/iuHp1GSWmjPJmGurff0FOpSArCmRZJtCO1JoCTVPpkA7DNGBZFur1Oup2HRZVx3HAizXE4h9P486N6xCUClIETJLKFT4CVkUJQlWCKMkQRBlVSYFCHRumGQFDkG3bkdptj4AqWZ6axsrNuzBtC1yGQSGRgVxgIUkSclwVyTyPDCtgPcdjPSsgV5Ihq8Y+qNFo7ANLvITYodPf4+7KY1imDi7HorC2CXljg4Ay8sUqNhkBabaKRE7AGgETeREVUaMO6/vAUCGQLQmIvfnJEi4ur8Kp62AzBRRSDCTKLlQ+7HAXuJGvIsVSBLIW2bXJ7h6s2Wyi2+2gLMiITX/4BVbu3YZNf4SWc+tZiBWBsqqBKYoRKMNJSHP0grICXtKgG9Y+qNVqRfL7PRQrZPnApyew8ssDuJ4LhYIv5SuQBRG6bkCgw5ygRhZZXkWhokLRqDMChVN1XZestuF5HoJgALbII3Zs/irurPyBmiZCpKnqBu2fpkOr12htpGh19qyFEM9zo7xCSAjbUwgs8WT5g6kF/HDzHu2UjlKVIZsZZGkPVb5IXerQNQ3OrjXXbUWgMK9utxup1+tR7WE0DChDWpvYa29jYekGhoMeRI1HpcqDY0vRDbGdFpp0C+yGQzbpVjguRdMmddAhmO/7GAwGUd3amtDZEPjGezh/6Ra9oU8ZCMgwFWQ5Idp6ldZGoaBFxaQIXNSMJlTTgWbRSxwCt7tod/vo9vp48XwLfAR8/V1cuHQbW5OAVoJWJF8AUyhCLgu0i1WUOA7ZPIcSTd6kuxuCHLdD6qLR6qBJ1Wv36PyYzhsh8B0sfrOM8dCnUFkkU0kwGwnU0imYLEO5cNikTGuqSvb8KPxhEJCjISYECa2GNexQ0RuvLI9HPhjKLpXjaDA8SqUqdFKNMpXJvkQybC/qqNcnKAHH4xC4FWl7+znqTnfH8jnqcDIOkE6nsb6eQCKZRLFQQJuW2+Ipx6oIh67Z3hCCYBhpNBphRNAh1bBDx6Mv9lvv0+fr2j0ENOXwc2RZZnRHPVraPgF8sugTZAe0Y3c8GuJFaHU8wvaLLbzc3sa/L/+B1WgjdvnHX5FIFzGeTAgQoD8IKGQKutOlKXaiFen7BBuNSRPqaALPH8PukbwuTKcPqzdAm/ZRNRr4D0q1Qm4zBSFcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-4\"\n        title=\"2-4\"\n        src=\"/static/5554f7697868fd6bb12c0af994781101/b97f6/4.png\"\n        srcset=\"/static/5554f7697868fd6bb12c0af994781101/5a46d/4.png 300w,\n/static/5554f7697868fd6bb12c0af994781101/0a47e/4.png 600w,\n/static/5554f7697868fd6bb12c0af994781101/b97f6/4.png 958w\"\n        sizes=\"(max-width: 958px) 100vw, 958px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>When this code is executed, this is how <code class=\"language-text\">badfile</code> will be filled.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 493px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAvklEQVQoz52RWwuDMAyF+///nY8T96TgHgRv9VKrZv3COjYoExY4NCanx+TUWGtlmiYZhkFS+S+M46jcmB/HIcY5p0nf97LvuxCQ1nXVOrUU6M3zrCAQRctEEQrbtmlxWRbx3stVwG/bVn/edZ3e+RKkwXkleJ7nW7AsS6nrWqqq0snN55qRiH+Q+Wa1FAgXOP6Vw9cJm6YRgCDGIoafMU+BHt49wlS3LJN7UUie51rXR2HVf8KHuzZ4h01xqydVpCJrk38wAwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-5\"\n        title=\"2-5\"\n        src=\"/static/b9167735e41de8ae4bd2c874c3d7ea44/f88d0/5.png\"\n        srcset=\"/static/b9167735e41de8ae4bd2c874c3d7ea44/5a46d/5.png 300w,\n/static/b9167735e41de8ae4bd2c874c3d7ea44/f88d0/5.png 493w\"\n        sizes=\"(max-width: 493px) 100vw, 493px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Compile and Execute <code class=\"language-text\">exploit.c</code> to create <code class=\"language-text\">badfile</code>, and run <code class=\"language-text\">stack</code>. A buffer overflow attack will be launched, and the root shell will be opened. We can check that the euid is set as root, and the attack has been successfully launched.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 946px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACEElEQVQoz02QW28SURSF52f4i4yJ8cEY22Kb1PjQCCi3ATFqNJjGVF9qDSZeuExSkKEDYcCWBEgp0sIAw30GaKGiVf/Hcp/TaHj4svc52Vlrry2sB4+wHB5hJWTi9schlj4ZsIRGWJLOYYn/Ii5giV1gheD9AqtffmMt8QfLuz9g2Z1jLf4TgvfpG/i9PjxwWuEQHbA+tGLDvkFvG+z0Z3dYee9wEVTZHPu3Oe5D9LsR2HwBj88Ft9cJ8ZEbwo31t7jn24YvmoQ/loNXSsMZkuH8LMMVSsIVTlKfwOOwjCc04wmzvz24GZE9eKLKZY0ovBfu2l9hOxhFqVREsVjCQT6P8lEFx8cnKJfLODwso93pYjg0YJgmRqMxJqenODubYjqdcWazc873+RzCzTs2PA9sIRIOQZIkvNvZQSwWh5rJQIpGoKpZaJqGVqsJvdVCp9NBv9fDYNAnkyHHMIYwTYPMRhBWr1mwRYJqVsX+131ks1nkactCoYD8QZ5vWq1WObVa7T91Mmk2m5x2uw1db6Pf70OwXr2F188CSKYUKIpCG6lIpVKQZRm5XA7pdBqJhMyNMrR1imZYrVS+8c2ZOBPV6hoXFmziJoIfJDS0OhqNJtHgAy2Kt4iu65xut0txBxTToJgmjzkejzmTyQTClesiXr6Pwxx0cUJuTHCRRUF2PybYoxuyeJf3+yc85uJ/AUUXHZW13qQNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-6\"\n        title=\"2-6\"\n        src=\"/static/f68a3c56e5d79c40f57a5755d32a421d/36c33/6.png\"\n        srcset=\"/static/f68a3c56e5d79c40f57a5755d32a421d/5a46d/6.png 300w,\n/static/f68a3c56e5d79c40f57a5755d32a421d/0a47e/6.png 600w,\n/static/f68a3c56e5d79c40f57a5755d32a421d/36c33/6.png 946w\"\n        sizes=\"(max-width: 946px) 100vw, 946px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>This is because when <code class=\"language-text\">bof()</code> is executed in <code class=\"language-text\">stack</code>, the size of <code class=\"language-text\">badfile</code> is bigger than <code class=\"language-text\">buffer</code>, so an buffer overflow occurs. The return address has been overwritten to a new address that points to the shellcode, and therefore the shellcode will be executed when <code class=\"language-text\">bof()</code> ends.</p>\n<h2 id=\"additional-countermeasures-aslr-stackguard-non-executable-stack\" style=\"position:relative;\"><a href=\"#additional-countermeasures-aslr-stackguard-non-executable-stack\" aria-label=\"additional countermeasures aslr stackguard non executable stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Additional) Countermeasures (ASLR, StackGuard, Non-executable stack)</h2>\n<p>The objective of this task is to learn the countermeasures against Buffer Overflow attack.</p>\n<h3 id=\"1-aslr-address-space-layout-randomization\" style=\"position:relative;\"><a href=\"#1-aslr-address-space-layout-randomization\" aria-label=\"1 aslr address space layout randomization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. ASLR (Address Space Layout Randomization)</h3>\n<p>Change <code class=\"language-text\">kernel.randomize_va_space</code> to 1, compile <code class=\"language-text\">exploit</code> and <code class=\"language-text\">stack</code> again, and execute them.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 953px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABrElEQVQozz2QXW/SYBxH+XheqPF60cnIvBmabFMvTFjm4uLLYuKCOAZCC7RDpO1SJmC2AGNjoymkvLeQ+GGOT8uyi5P/W56TX55QNNshUpixLg0JZwasZRzW5SGr8oxnPtKSp3esym4w+/eIsmCtsOC52EXyHi+UOaG3W7tEY/tEE2leJjJsxFO8OsqydSyzmVzW18cSsbTETibHprhtp3JiL7FbNPhi1okpvwUaOyc6oYfhQ97sJcmWyvz8pfNdPkE1a0iaSfHsL5XmNbWrLmeNNn9Eb1xcUm3fUmldCzq0nQlXgpuRi+39I7T97hsfP8fJZ9MUlQKpZBKjXA4wDQOtVMI8NdDFfNlo0LctrJsOdvcW2+rSE/j9oN9j4bmEHjwJ8/7DV5RCHlVVSfw4QtN1NE1DzuVE1Wk2W7RaLXq9HoPBgNFozHg8ZjKdMpvNcF0Xz/ME4g83Hq1wsPdJPJZRFYWkSKjrBvV6HdOsYFkW/X4/wBc6jsNwOAyEgXQyCfDF87kQRh+vED84pCYEtWo1kJyfXwSJfIlt2/f48zLh6F40FSmnd0n9lP8Bimun6uwJw8wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-1\"\n        title=\"2-1\"\n        src=\"/static/4476ad08dd08f292d09ce3004f63cf5e/38124/1.png\"\n        srcset=\"/static/4476ad08dd08f292d09ce3004f63cf5e/5a46d/1.png 300w,\n/static/4476ad08dd08f292d09ce3004f63cf5e/0a47e/1.png 600w,\n/static/4476ad08dd08f292d09ce3004f63cf5e/38124/1.png 953w\"\n        sizes=\"(max-width: 953px) 100vw, 953px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Change <code class=\"language-text\">kernel.randomize_va_space</code> to 2, compile <code class=\"language-text\">exploit</code> and <code class=\"language-text\">stack</code> again, and execute them.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 955px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABqElEQVQoz0WOXW/SYBiG+wON8cAYdcr8ONAsRPEj0WzOTI1R4skSVBhQChSEgUAHTogwGK7b0hbKZzv0z1y+Lcs8uHLf7/MmV24plNYJKFPuymNuJ2wCSZs7oq+kHG7K/7khuC5YSbkXt0Dmj88tcVtNL5FePH/D2vpbgl8SBD8nWYvERZcJxdKEoimRCk8FG3GFzWSG0FeZJztpHou/1/nvhLUmG2pJUPZTunw/wrOtGMpuifi3MhElR7ZaRy7VKNSbaO1D9g+P2Wv3aBz0qf4S2dOpd3+jdfr0rDH94YSj0RzT/Yv06OU2H8IRcmmZvJolsROjXCxSKZWo16p+/7Gn+XnQbjMwDU71I4yTY8zTE4xzbMtk4TpIl649YHMrTD6noqoq0WiMQkEIKxX/XRTLO50O3W4XwzCwbZvxeMJkMmE6nTGfz3EcB9d1cc/OkB5eWeXjq3dkhTCbyfrCXSFptVrUajV0XWcwGGBZlsBkOBwyGo184VI69fHEi8UCKXj1HtvvP7Hf/Emj3kDTNF/mrfIkpmn6yzxM0zpfOL4QzWbLlR7eyn/hQKeLdWpq4wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-1\"\n        title=\"2-1\"\n        src=\"/static/ddb2e1c1b4c29b1914df7b410cd248c7/a0b80/2.png\"\n        srcset=\"/static/ddb2e1c1b4c29b1914df7b410cd248c7/5a46d/2.png 300w,\n/static/ddb2e1c1b4c29b1914df7b410cd248c7/0a47e/2.png 600w,\n/static/ddb2e1c1b4c29b1914df7b410cd248c7/a0b80/2.png 955w\"\n        sizes=\"(max-width: 955px) 100vw, 955px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>In both cases, a segmentation fault occurs. A segmentation fault is an error that occurs when a program attempted to access a restricted area of memory.</p>\n<p>When <code class=\"language-text\">kernel.randomize_va_space</code> is set as 1, ASLR is enabled on the stack memory. When <code class=\"language-text\">kernel.randomize_va_space</code> is set as 2, ASLR is enabled on both the heap and stack memory. ASLR randomizes the start location of the stack or heap, which makes the stack and heap address change every time the code is loaded in the memory. Therefore, the <code class=\"language-text\">%ebp</code> address and address of the malicious code changes every time, and this makes the content in <code class=\"language-text\">badfile</code> created by <code class=\"language-text\">exploit</code> point to the wrong address. This causes the segmentation fault.</p>\n<h3 id=\"2-stackguard\" style=\"position:relative;\"><a href=\"#2-stackguard\" aria-label=\"2 stackguard permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. StackGuard</h3>\n<p>Compile <code class=\"language-text\">stack.c</code> without <code class=\"language-text\">-fno-stack-protector</code> and then execute <code class=\"language-text\">exploit</code> and <code class=\"language-text\">stack</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 955px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABgElEQVQY00XOX2/SYBSA8X5FvXLLAvHCxMxp2BJjhOCVTk28MTjZRil/WijtGFB1GDKQllAIhLCWttT5ZR5fmhgvfjnnPRdPXumlNiddDXiseKRKa1LymrR8x4ESsV/+b094tNv/3cVM1e5J1e85qGxJ12LR2SK9zn/i5M0pz85kjr7IHBYuOTorkzmvCpXEiZC9rJCXqxwXFY4vqrz4WiZXN3jf7ZMVM6eaCenBkwKZfJGKYSLrbQqKSu36G4rRoWH16d7a3Ngu1u2Y7yOHq59DbpwZg+mC/mTO1AuZB7Hwm0X0BymT/czphwJaTUHXVOSLcwxd59o0sLpdrlotflgWprgNBwPm7pTFbMY22BCHAdHGFzZEu3cUIj3cP+RV7i2qWkcTwWKxiNZo0ul0xGxgiJ8PRyN+jccsl0s8zxN81uu7ZN+IWBAEhGHINo6Rnu895WP+HWa7TavZpFSSk0iv10Nv6ti2jeu6TCaThOM4rFarJOT7fhLbiaKIWAT/AoeHZz+7atcgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-3\"\n        title=\"2-3\"\n        src=\"/static/b27e1c27ec8abd0286700c62c2824141/a0b80/3.png\"\n        srcset=\"/static/b27e1c27ec8abd0286700c62c2824141/5a46d/3.png 300w,\n/static/b27e1c27ec8abd0286700c62c2824141/0a47e/3.png 600w,\n/static/b27e1c27ec8abd0286700c62c2824141/a0b80/3.png 955w\"\n        sizes=\"(max-width: 955px) 100vw, 955px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>This time, the program is automatically terminated after detecting a stack smashing.</p>\n<p>When stack guard is used, a secret value is saved between the buffer and return address.</p>\n<p>Before ending the function <code class=\"language-text\">bof()</code>, the secret value is checked. If the value has changed, it is detected that an buffer overflow attack has occured.</p>\n<h3 id=\"3-non-executable-stack\" style=\"position:relative;\"><a href=\"#3-non-executable-stack\" aria-label=\"3 non executable stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Non-executable stack</h3>\n<p>Compile <code class=\"language-text\">stack.c</code> with <code class=\"language-text\">-z noexestack</code> and then execute <code class=\"language-text\">exploit</code> and <code class=\"language-text\">stack</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 950px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABwElEQVQoz1WOS28SYRSG5we6UBcuTCpQYOiUW00bW9MqC2NUFsbYVDEW5TIXZqagLCq2lFAFm5KZYbgGo2ms8Yc8fqAuXDx5v3NyvievpLw9I6R+JVyeEShMCBanRMQc0C5YUi+49Zcl9f95Tsi4JGL9+pOVS2TrJ9La3Swb6TQrSZnEeopYMkYwFkJORJHjUSKrYaICJR5hJS7eIue7sLJMaiPJ5s4d8Tcm7mWUtIJ0LbzLzfQTlN088Zcay09fs/qijPy8gLJXYm3fYv2Nzda+wXbBFjcqt/P2Yp98pbNT+UDG/kjm4Ij7IqXU1jMeZ/eomTq2YaCXitSrBxzW6zQbh5w0GnRP25wcH3HaanH2+RO9L12Gnst5t4PX6zF0XYHDj+/fkK7ckNnOPELXNTRdp1AoohsV3r2vY1kWxbKKaZqUSiWOm01c18MRgn7fx+v3BT5938cfDBhPJkixqwGymYfoFQNNVcnlckJgUa1W0TUN07JpiWbtdptz0WYu8YVgIATD4ZDxeLxgOp0ym82QEteDZO89QDP0hSCfz2PZNk3Rplar0el0RCtX4OA4Dp7nLWSj0WjBP+FEtJsLfwPssZbAcvQniQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2-4\"\n        title=\"2-4\"\n        src=\"/static/90180ddf44036e6f7df954d837e5a95e/906b5/4.png\"\n        srcset=\"/static/90180ddf44036e6f7df954d837e5a95e/5a46d/4.png 300w,\n/static/90180ddf44036e6f7df954d837e5a95e/0a47e/4.png 600w,\n/static/90180ddf44036e6f7df954d837e5a95e/906b5/4.png 950w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>This time, a segmentation fault occurs.</p>\n<p>When Non-executable stack is used, certain areas of the memory are marked as non-executable. Therefore, even though a buffer overflow occurs, the non-executable stack protection prevents the program from running the shellcode, and a segmentation fault occurs.</p>","frontmatter":{"title":"[SEED labs] Buffer Overflow Vulnerability Lab","date":"December 10, 2021"}}},"pageContext":{"slug":"/SEEDlabs/bufferoverflow/","previous":{"fields":{"slug":"/SEEDlabs/environmentvariables/"},"frontmatter":{"title":"[SEED labs] Environment Variable and Set-UID Program Lab (2)"}},"next":{"fields":{"slug":"/Algorithm/basic_algorithm_study_0/"},"frontmatter":{"title":"[Basic Algorithm Study] 소개"}}}},"staticQueryHashes":["2486386679","3128451518"]}